<div class="page">
  <div class="header">
    <h1 class="header__title" [ngSwitch]="isNewProduct">
      <ng-container *ngSwitchCase="true">
        Новый товар
      </ng-container>

      <ng-container *ngSwitchCase="false">
        {{ product?.name }}
      </ng-container>
    </h1>

    <div class="header__toolbar">
      <button class="header__btn toolbar-btn" (click)="goBack()">
        <i class="ai ai-arrow-left"></i> назад
      </button>
      <button class="header__btn toolbar-btn" *ngIf="!isNewProduct" (click)="delete()">
        Удалить
      </button>
      <button class="header__btn toolbar-main-btn" (click)="save()">Сохранить</button>
    </div>
  </div>

  <form class="product" *ngIf="form" [formGroup]="form">

    <div class="product__field field"
           *ngIf="form.get('isEnabled') as isEnabled"
           [class.field--invalid]="isControlInvalid(isEnabled)"
    >
      <label class="field__label" for="isEnabled">Включить категорию</label>
      <div class="field__control">
        <label class="switcher">
          <input class="switcher__input"
                 [formControl]="isEnabled"
                 type="checkbox"
                 id="isEnabled"
          >
          <span class="switcher__control" [class.switcher__control--active]="isEnabled.value"></span>
          <span class="switcher__description">
            <ng-container *ngIf="isEnabled.value; else isEnabledFalseText">Да</ng-container>
            <ng-template #isEnabledFalseText>Нет</ng-template>
          </span>
        </label>
      </div>
    </div>

    <div class="product__field field field--required"
         *ngIf="form.get('name') as name"
         [class.field--invalid]="isControlInvalid(name)"
    >
      <label for="name" class="field__label">Название товара</label>
      <span class="field__control">
        <input class="field__input" [formControl]="name" type="text" id="name">
      </span>
    </div>

    <div class="product__field field" *ngIf="form.get('categoryIds') as categoryIds">
      <label class="field__label">Категории</label>
      <span class="field__control">
        <category-select [formControl]="categoryIds"></category-select>
      </span>
    </div>

    <fields-group class="product__group" [id]="'product-attributes'">
      <div class="group-title">Атрибуты<span *ngIf="isMultiVariant"> (общие)</span></div>

      <ng-container *ngIf="form.get('attributes') as attributes">
        <div class="product__field field"
               *ngFor="let attribute of attributes.value"
        >
          <label for="name" class="field__label">{{ attribute.id }}</label>
          <span class="field__control">
            {{ attribute.valueIds | json }}
          </span>
        </div>
      </ng-container>

      <button class="product__edit-attributes" (click)="editAttributes()">
        Редактировать атрибуты
      </button>
    </fields-group>

    <fields-group *ngFor="let variantForm of variantsFormArray?.controls, index as i"
                  [class.product__group]="isMultiVariant"
                  [showHeader]="isMultiVariant"
    >

      <div class="group-title" *ngIf="isMultiVariant">
        Вариация {{ i + 1 }} - {{ variantForm.get('name') && variantForm.get('name').value }}
      </div>

      <div class="product__field field field--required"
           *ngIf="variantForm.get('name') as name"
           [class.field--invalid]="isControlInvalid(name)"
      >
        <label class="field__label" [for]="'name-' + i">Название товара</label>
        <span class="field__control">
          <input class="field__input" [formControl]="name" type="text" [id]="'name-' + i">
        </span>
      </div>

      <div class="product__field field field--required"
           *ngIf="variantForm.get('sku') as sku"
           [class.field--invalid]="isControlInvalid(sku)"
      >
        <label class="field__label" [for]="'sku-' + i">Артикул</label>
        <span class="field__control">
          <input class="field__input" [formControl]="sku" [id]="'sku-' + i" type="text">
        </span>
      </div>

      <div class="product__field field field--required"
             *ngIf="variantForm.get('price') as price"
             [class.field--invalid]="isControlInvalid(price)"
      >
        <label class="field__label" [for]="'price-' + i">Цена</label>
        <span class="field__control">
          <input class="field__input" [formControl]="price" [id]="'price-' + i" type="text">
        </span>
      </div>

      <div class="product__field field"
             *ngIf="variantForm.get('qty') as qty"
      >
        <label class="field__label" [for]="'qty-' + i">Количество</label>
        <span class="field__control">
          <input class="field__input" [formControl]="qty" [id]="'qty-' + i" type="text">
        </span>
      </div>

      <fields-group class="product__group">
        <div class="group-title">Контент</div>

        <div class="product__field field"
               *ngIf="variantForm.get('fullDescription') as fullDescription"
        >
          <label class="field__label" [for]="'desc-' + i">Описание</label>
          <span class="field__control">
            <angular-editor [formControl]="fullDescription" [config]="editorConfig" [id]="'desc-' + i"></angular-editor>
          </span>
        </div>

        <div class="product__field field"
               *ngIf="variantForm.get('shortDescription') as shortDescription"
        >
          <label class="field__label" [for]="'s-desc-' + i">Короткое описание</label>
          <span class="field__control">
            <angular-editor [formControl]="shortDescription" [config]="editorConfig" [id]="'s-desc-' + i"></angular-editor>
          </span>
        </div>
      </fields-group>

      <fields-group class="product__group">
        <div class="group-title">SEO</div>

        <div class="product__field field"
               *ngIf="variantForm.get('slug') as slug"
        >
          <label class="field__label" [for]="'slug-' + i">URL адрес</label>
          <span class="field__control">
            <input class="field__input" [formControl]="slug" [id]="'slug-' + i" type="text">
          </span>
        </div>

        <div class="product__field field"
               *ngIf="variantForm.get('metaTags.title') as metaTitle"
        >
          <label class="field__label" [for]="'metaTitle-' + i">Meta заголовок</label>
          <span class="field__control">
            <input class="field__input" [formControl]="metaTitle" [id]="'metaTitle-' + i" type="text">
          </span>
        </div>

        <div class="product__field field"
               *ngIf="variantForm.get('metaTags.description') as metaDescription"
        >
          <label class="field__label" [for]="'metaDesc-' + i">Meta описание</label>
          <span class="field__control">
            <textarea class="field__textarea" [formControl]="metaDescription" [id]="'metaDesc-' + i"></textarea>
          </span>
        </div>

        <div class="product__field field"
               *ngIf="variantForm.get('metaTags.keywords') as metaKeywords"
        >
          <label class="field__label" [for]="'metaKeys-' + i">Meta ключевые слова</label>
          <span class="field__control">
            <textarea class="field__textarea" [formControl]="metaKeywords" [id]="'metaKeys-' + i"></textarea>
          </span>
        </div>
      </fields-group>

      <fields-group class="product__group">
        <div class="group-title">Картинки и видео</div>

        <div class="product__field media" *ngIf="variantForm.get('medias') as medias">
          <media-asset class="media__asset"
                       *ngFor="let media of medias.value"
                       [media]="media"
                       (remove)="onMediaRemove(media)"
          ></media-asset>

          <media-uploader class="media_asset"
                          [uploadUrl]="getMediaUploadUrl()"
                          (uploaded)="mediaUploaded($event, medias)"
          ></media-uploader>

        </div>
      </fields-group>

    </fields-group>

    <fields-group class="product__group">
      <div class="group-title">Отзывы</div>
      In progress...
    </fields-group>

  </form>

</div>

